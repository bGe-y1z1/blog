# 微前端的设计思路

在 toB 的前端开发工作中，我们往往就会遇到如下困境：

工程越来越大，打包越来越慢
团队人员多，产品功能复杂，代码冲突频繁、影响面大
内心想做 SaaS 产品，但客户总是要做定制化

## 为什么需要微前端

- 遗留系统迁移 解决遗留系统，才是人们采用微前端方案最重要的原因。
- 聚合前端应用 微服务架构，可以解耦后端服务间依赖。而微前端，则关注于聚合前端应用。
- 热闹驱动开发 新的技术，既然很热闹，那么就学吧。

## 微前端的好处

- 应用自治 只需要遵循统一的接口规范或者框架，以便于系统集成到一起，相互之间是不存在依赖关系的。
- 单一职责 每个前端应用可以只关注于自己所需要完成的功能
- 技术栈无关 你可以使用 Angular 的同时，又可以使用 React 和 Vue。

:::danger
过多的技术栈的缺点：
应用的拆分基础依赖于基础设施的构建，一旦大量应用依赖于同一基础设施，那么维护变成了一个挑战。
拆分的粒度越小，便意味着架构变得复杂、维护成本变高。
技术栈一旦多样化，便意味着技术栈混乱。
:::

## 如何设计微前端架构？

### 设计理念

- 中心化：
  应用注册表。这个应用注册表拥有每个应用及对应的入口。在前端领域里，入口的直接表现形式可以是路由，又或者对应的应用映射。

- 标识化应用。
  我们需要一个标识符来标识不同的应用，以便于在安装、卸载的时候，能寻找到指定的应用。

- 应用生命周期管理。

- 高内聚，低耦合。

### 生命周期

前端微架构与后端微架构的最大不同之处，也在于此——生命周期。微前端应用作为一个客户端应用，每个应用都拥有自己的生命周期：

- Load，决定加载哪个应用，并绑定生命周期
- bootstrap，获取静态资源
- Mount，安装应用，如创建 DOM 节点
- Unload，删除应用的生命周期
- Unmount，卸载应用，如删除 DOM 节点、取消事件绑定

这部分的内容事实上，也就是微前端的一个难点所在，如何以合适的方式来加载应用——毕竟每个前端框架都各自不同，其所需要的加载方式也是不同的。当我们决定支持多个框架的时候，便需要在这一部分进入更细致的研究。

### 技术方式

#### 路由分发式

通过 node koa 框架搭建路由分发

![mfe](/mfe/mfe1.jpeg)
![mfe](/mfe/mfe2.jpeg)

#### 前端微服务化

前端微服务化，是微服务架构在前端的实施，每个前端应用都是完全独立（技术栈、开发、部署、构建独立）、自主运行的，最后通过模块化的方式组合出完整的前端应用

![mfe](/mfe/mfe3.jpeg)

#### npm 私有库 插入和组件公用

搭建 npm 私有仓库来管理个加载业务组件或者 UI 组件，实现微应用的共享和统一规范化
