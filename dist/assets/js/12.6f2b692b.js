(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{459:function(s,t,a){"use strict";a.r(t);var e=a(49),n=Object(e.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"持续部署jenkins"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#持续部署jenkins"}},[s._v("#")]),s._v(" 持续部署jenkins")]),s._v(" "),a("p",[a("img",{attrs:{src:"/Jenkins/jenkinsList.png",alt:"nodeJS"}})]),s._v(" "),a("h3",{attrs:{id:"一、安装jenkins-安装步骤请看jenkens官网"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一、安装jenkins-安装步骤请看jenkens官网"}},[s._v("#")]),s._v(" 一、安装jenkins 安装步骤请看"),a("a",{attrs:{href:"https://jenkins.io/zh/doc/tutorials/build-a-node-js-and-react-app-with-npm/#fork-sample-repository",target:"_blank",rel:"noopener noreferrer"}},[s._v("jenkens官网"),a("OutboundLink")],1)]),s._v(" "),a("p",[s._v("1、安装JDK")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[s._v("  yum install -y java\n")])])]),a("p",[s._v("2、 安装jenkins")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[s._v("   1 wget -O /etc/yum.repos.d/jenkins.repo http://pkg.jenkins-ci.org/redhat/jenkins.repo\n   2 rpm --import https://jenkins-ci.org/redhat/jenkins-ci.org.key\n   3 yum install -y jenkins\n")])])]),a("p",[s._v("如果不能安装就到官网下载jenkis的rmp包，官网地址（http://pkg.jenkins-ci.org/redhat-stable/）")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[s._v("   1 wget http://pkg.jenkins-ci.org/redhat-stable/jenkins-2.7.3-1.1.noarch.rpm\n   2 rpm -ivh jenkins-2.7.3-1.1.noarch.rpm\n")])])]),a("p",[s._v("配置jenkis的端口")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[s._v("vi /etc/sysconfig/jenkins\n")])])]),a("p",[s._v("找到修改端口号：")]),s._v(" "),a("p",[s._v('JENKINS_PORT="8080"  此端口不冲突可以不修改')]),s._v(" "),a("p",[s._v("3、启动jenkins")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[s._v("service jenkins start/stop/restart\n")])])]),a("div",{staticClass:"custom-block tip"},[a("p",[s._v("安装成功后Jenkins将作为一个守护进程随系统启动")]),s._v(" "),a("p",[s._v("系统会创建一个“jenkins”用户来允许这个服务，如果改变服务所有者，同时需要修改/var/log/jenkins, /var/lib/jenkins, 和/var/cache/jenkins的所有者")]),s._v(" "),a("p",[s._v("启动的时候将从/etc/sysconfig/jenkins获取配置参数")]),s._v(" "),a("p",[s._v("默认情况下，Jenkins运行在8080端口，在浏览器中直接访问该端进行服务配置")]),s._v(" "),a("p",[s._v("Jenkins的RPM仓库配置被加到/etc/yum.repos.d/jenkins.repo")])]),s._v(" "),a("p",[s._v("4、打开jenkins")]),s._v(" "),a("p",[s._v("在浏览器中访问\n首次进入会要求输入初始密码如下图，\n初始密码在：/var/lib/jenkins/secrets/initialAdminPassword\n66ccf7466b1d4bfdaefbc1113470a4e2")]),s._v(" "),a("h3",{attrs:{id:"二、-jenkins相关插件的安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二、-jenkins相关插件的安装"}},[s._v("#")]),s._v(" 二、 jenkins相关插件的安装")]),s._v(" "),a("h5",{attrs:{id:"_1、安装nodejs插件-用于项目打包"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1、安装nodejs插件-用于项目打包"}},[s._v("#")]),s._v(" 1、安装nodeJS插件 用于项目打包")]),s._v(" "),a("p",[s._v("打开 "),a("em",[s._v("系统管理")]),s._v(" -- "),a("em",[s._v("插件管理")]),s._v(" -- 点击 "),a("em",[s._v("Available")]),s._v(" -- 搜索 NodeJS Plugin  然后勾选安装")]),s._v(" "),a("p",[s._v("打开 "),a("em",[s._v("系统管理")]),s._v(" --"),a("em",[s._v("全局工具配置")]),s._v("   拉到底部 配置  node 版本，如图：")]),s._v(" "),a("p",[a("img",{attrs:{src:"/Jenkins/nodeJS.jpg",alt:"nodeJS"}})]),s._v(" "),a("div",{staticClass:"custom-block warning"},[a("p",[s._v("node 使用13.1.0 版本 如需其他版本自行安装")])]),s._v(" "),a("h5",{attrs:{id:"_2、-配置远程链接"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2、-配置远程链接"}},[s._v("#")]),s._v(" 2、 配置远程链接")]),s._v(" "),a("p",[s._v("打开 "),a("em",[s._v("系统管理")]),s._v(" -- "),a("em",[s._v("系统设置")]),s._v("  找到 “Publish over SSH” 项 ，我这里远程服务器用的是ssh登录，通过ppk密钥进行连接，所以我的配置如图，如果是帐号密码登录的Passphrase填写密码Username填写用户名，path to key 为空就可以了。")]),s._v(" "),a("p",[a("img",{attrs:{src:"/Jenkins/ssh1.png",alt:"nodeJS"}})]),s._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",[s._v("获取私钥key值 cat XXX.pem")])]),s._v(" "),a("p",[s._v("点击 Test Configuration 按钮测试连接是否成功")]),s._v(" "),a("p",[a("img",{attrs:{src:"/public/Jenkins/ssh2.png",alt:"nodeJS"}})]),s._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",[s._v("前端配置项:"),a("br"),s._v("\n开发： web-dev"),a("br"),s._v("\n测试： web-ft"),a("br"),s._v("\n项目根目录： /usr/local/nginx")])]),s._v(" "),a("h3",{attrs:{id:"三、-配置自动部署任务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#三、-配置自动部署任务"}},[s._v("#")]),s._v(" 三、 配置自动部署任务")]),s._v(" "),a("h5",{attrs:{id:"_1、新建任务：点击-新建-填写任务名称，选择构建一个自由风格的软件项目然后保存，如图："}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1、新建任务：点击-新建-填写任务名称，选择构建一个自由风格的软件项目然后保存，如图："}},[s._v("#")]),s._v(" 1、新建任务：点击 "),a("em",[s._v("新建")]),s._v(" --填写任务名称，选择"),a("em",[s._v("构建一个自由风格的软件项目")]),s._v("然后保存，如图：")]),s._v(" "),a("p",[a("img",{attrs:{src:"/Jenkins/newJob1.png",alt:"nodeJS"}})]),s._v(" "),a("h5",{attrs:{id:"_2、配置git，进入任务配置，选择源码管理-，我这里是git下载项目，所以选择-git-，因为是开源的，所以没有填写账号密码，如图"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2、配置git，进入任务配置，选择源码管理-，我这里是git下载项目，所以选择-git-，因为是开源的，所以没有填写账号密码，如图"}},[s._v("#")]),s._v(" 2、配置git，进入任务配置，选择源码管理 ，我这里是git下载项目，所以选择 git ，因为是开源的，所以没有填写账号密码，如图")]),s._v(" "),a("p",[a("img",{attrs:{src:"/Jenkins/newJob2.png",alt:"nodeJS"}})]),s._v(" "),a("h5",{attrs:{id:"_3、设置构建环境，选择-provide-node-npm-bin-folder-to-path-然后选择之前安装插件时候配置的node版本，如图"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3、设置构建环境，选择-provide-node-npm-bin-folder-to-path-然后选择之前安装插件时候配置的node版本，如图"}},[s._v("#")]),s._v(" 3、设置构建环境，选择 Provide Node & npm bin/ folder to PATH  然后选择之前安装插件时候配置的node版本，如图")]),s._v(" "),a("p",[a("img",{attrs:{src:"/Jenkins/newJob3.png",alt:"nodeJS"}})]),s._v(" "),a("h5",{attrs:{id:"_4、配置项目自动化打包，选择-增加构建步骤-excute-shell-这个是运行相关的sh命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4、配置项目自动化打包，选择-增加构建步骤-excute-shell-这个是运行相关的sh命令"}},[s._v("#")]),s._v(" 4、配置项目自动化打包，选择 增加构建步骤 ---Excute shell  这个是运行相关的sh命令")]),s._v(" "),a("div",{staticClass:"language-js extra-class"},[a("div",{staticClass:"highlight-lines"},[a("br"),a("br"),a("br"),a("div",{staticClass:"highlighted"},[s._v(" ")]),a("br"),a("br"),a("br"),a("br"),a("br")]),a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[s._v("   echo $"),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("PATH")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 进入项目目录")]),s._v("\n   npm install chromedriver "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("chromedriver_cdnurl"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("http"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("cdn"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("npm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("taobao"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("org"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("dist"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("chromedriver \n   npm install \n   npm run build \n   cd dist \n   rm "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("rf build"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("tar"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("gz  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 删除上次打包的压缩文件")]),s._v("\n   tar "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("zcvf build"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("tar"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("gz "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 把生成的项目打包成build 方便传输到远程服务器")]),s._v("\n   cd "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" \n")])])]),a("p",[a("img",{attrs:{src:"/Jenkins/newJob4.png",alt:"nodeJS"}})]),s._v(" "),a("h5",{attrs:{id:"_5、把打包好的项目文件发布到远程服务器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5、把打包好的项目文件发布到远程服务器"}},[s._v("#")]),s._v(" 5、把打包好的项目文件发布到远程服务器")]),s._v(" "),a("p",[s._v("选择 "),a("em",[s._v("Add build step")]),s._v("  --- "),a("em",[s._v("Send build artifacts over SSH")])]),s._v(" "),a("p",[a("img",{attrs:{src:"/Jenkins/newJob5.png",alt:"nodeJS"}})]),s._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",[s._v("Name：第三步创建的远程服务器名称"),a("br"),s._v("\n Source files：本地需要传输过去的文件路径"),a("br"),s._v("\nRemove prefix：过滤掉的目录名"),a("br"),s._v("\nRemote directory：远程服务器的保存路径"),a("br"),s._v("\nExec command：传输完成后在远程服务器执行的sh命令")])]),s._v(" "),a("p",[a("img",{attrs:{src:"/Jenkins/newJob6.png",alt:"nodeJS"}})]),s._v(" "),a("div",{staticClass:"language-js extra-class"},[a("div",{staticClass:"highlight-lines"},[a("br"),a("br"),a("br"),a("div",{staticClass:"highlighted"},[s._v(" ")])]),a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[s._v("    cd "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("usr"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("local"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("nginx"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("cms "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 进入前端项目目录")]),s._v("\n    tar "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("zxvf build"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("tar"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("gz "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("C")]),s._v(" dms "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 将build压缩包文件解压到dms目录")]),s._v("\n    rm "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("rf build"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("tar"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("gz "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 删除压缩包")]),s._v("\n")])])]),a("h5",{attrs:{id:"_6、保存并构建-持续部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6、保存并构建-持续部署"}},[s._v("#")]),s._v(" 6、保存并构建&持续部署")]),s._v(" "),a("p",[a("img",{attrs:{src:"/public/Jenkins/newJob7.png",alt:"nodeJS"}})]),s._v(" "),a("h5",{attrs:{id:"_7、-注意是事项"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7、-注意是事项"}},[s._v("#")]),s._v(" 7、 注意是事项")]),s._v(" "),a("div",{staticClass:"custom-block danger"},[a("p",[s._v("1、访问403 目录权限不够 在服务器上执行 chmod -R 755 /usr/local/nginx/cms")]),s._v(" "),a("p",[s._v("2、 nodeJS插件安装不上可以下载node的.hpi文件 之后安装或重启")])]),s._v(" "),a("p",[a("img",{attrs:{src:"/Jenkins/newJob8.png",alt:"nodeJS"}})])])}),[],!1,null,null,null);t.default=n.exports}}]);