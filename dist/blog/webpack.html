<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>webpack4 | B格</title>
    <meta name="generator" content="VuePress 1.4.1">
    
    <meta name="description" content=" 装B的起点">
    <link rel="preload" href="/assets/css/0.styles.7e68d62a.css" as="style"><link rel="preload" href="/assets/js/app.7c156770.js" as="script"><link rel="preload" href="/assets/js/2.749b24a5.js" as="script"><link rel="preload" href="/assets/js/3.df6a8ba6.js" as="script"><link rel="preload" href="/assets/js/18.b0d81135.js" as="script"><link rel="prefetch" href="/assets/js/10.5e9277d7.js"><link rel="prefetch" href="/assets/js/11.d4b8a8ac.js"><link rel="prefetch" href="/assets/js/12.6f2b692b.js"><link rel="prefetch" href="/assets/js/13.2f7d6f22.js"><link rel="prefetch" href="/assets/js/14.1def7d66.js"><link rel="prefetch" href="/assets/js/15.887cdbe4.js"><link rel="prefetch" href="/assets/js/16.3a9c218e.js"><link rel="prefetch" href="/assets/js/17.824821fc.js"><link rel="prefetch" href="/assets/js/19.c54089ab.js"><link rel="prefetch" href="/assets/js/20.5b4f089c.js"><link rel="prefetch" href="/assets/js/21.678db35e.js"><link rel="prefetch" href="/assets/js/22.804a4d79.js"><link rel="prefetch" href="/assets/js/23.c74499b5.js"><link rel="prefetch" href="/assets/js/24.9416a77b.js"><link rel="prefetch" href="/assets/js/25.aacc9a3d.js"><link rel="prefetch" href="/assets/js/26.26fc0adc.js"><link rel="prefetch" href="/assets/js/27.8e7e8dfe.js"><link rel="prefetch" href="/assets/js/28.02240e31.js"><link rel="prefetch" href="/assets/js/29.3ed909da.js"><link rel="prefetch" href="/assets/js/30.4acb31c6.js"><link rel="prefetch" href="/assets/js/31.8ffb8b13.js"><link rel="prefetch" href="/assets/js/32.7b9fd860.js"><link rel="prefetch" href="/assets/js/33.870977d0.js"><link rel="prefetch" href="/assets/js/34.d5402422.js"><link rel="prefetch" href="/assets/js/35.31909f30.js"><link rel="prefetch" href="/assets/js/36.8ffb016f.js"><link rel="prefetch" href="/assets/js/37.333e173b.js"><link rel="prefetch" href="/assets/js/38.5e702917.js"><link rel="prefetch" href="/assets/js/39.cb3b41bd.js"><link rel="prefetch" href="/assets/js/4.bc7f5b84.js"><link rel="prefetch" href="/assets/js/40.a2d37bbb.js"><link rel="prefetch" href="/assets/js/41.48312e00.js"><link rel="prefetch" href="/assets/js/42.975380f2.js"><link rel="prefetch" href="/assets/js/43.ce019730.js"><link rel="prefetch" href="/assets/js/44.a2d26c9f.js"><link rel="prefetch" href="/assets/js/45.410e2f26.js"><link rel="prefetch" href="/assets/js/46.cac8533c.js"><link rel="prefetch" href="/assets/js/47.6444c333.js"><link rel="prefetch" href="/assets/js/48.86493991.js"><link rel="prefetch" href="/assets/js/49.c8f4241a.js"><link rel="prefetch" href="/assets/js/5.a677749f.js"><link rel="prefetch" href="/assets/js/50.caa88de1.js"><link rel="prefetch" href="/assets/js/51.b5e6263a.js"><link rel="prefetch" href="/assets/js/52.887546f3.js"><link rel="prefetch" href="/assets/js/53.3da30082.js"><link rel="prefetch" href="/assets/js/54.8013f1c1.js"><link rel="prefetch" href="/assets/js/6.dfbc0cb1.js"><link rel="prefetch" href="/assets/js/7.6f97340a.js"><link rel="prefetch" href="/assets/js/8.8c9ac2b3.js"><link rel="prefetch" href="/assets/js/9.baeb6ae4.js">
    <link rel="stylesheet" href="/assets/css/0.styles.7e68d62a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/hero.png" alt="B格" class="logo"></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">home</a></div><div class="nav-item"><a href="/pages/webpack/" class="nav-link">webpack</a></div><div class="nav-item"><a href="/pages/es6/letVarConst.html" class="nav-link">ES6</a></div><div class="nav-item"><a href="/pages/vue/" class="nav-link">vue</a></div><div class="nav-item"><a href="/pages/react/" class="nav-link">react</a></div><div class="nav-item"><a href="/pages/node/" class="nav-link">node</a></div><div class="nav-item"><a href="/blog/" class="nav-link router-link-active">blog</a></div><div class="nav-item"><a href="https://github.com/bGe-y1z1/blog" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">home</a></div><div class="nav-item"><a href="/pages/webpack/" class="nav-link">webpack</a></div><div class="nav-item"><a href="/pages/es6/letVarConst.html" class="nav-link">ES6</a></div><div class="nav-item"><a href="/pages/vue/" class="nav-link">vue</a></div><div class="nav-item"><a href="/pages/react/" class="nav-link">react</a></div><div class="nav-item"><a href="/pages/node/" class="nav-link">node</a></div><div class="nav-item"><a href="/blog/" class="nav-link router-link-active">blog</a></div><div class="nav-item"><a href="https://github.com/bGe-y1z1/blog" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <!----> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="webpack4"><a href="#webpack4" class="header-anchor">#</a> webpack4</h1> <p>webpack4 的构建 <a href="https://github.com/bGe-y1z1/webpack4" target="_blank" rel="noopener noreferrer">demo<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>安装 webpack webpack-cli</p> <blockquote><p>yarn add webpack webpack-cli -D</p></blockquote> <p>创建配置文件</p> <blockquote><p>mkdir webpack.config.js</p></blockquote> <p>配置入口和出口</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// webpack.config.js</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> webpackConfig <span class="token operator">=</span> <span class="token punctuation">{</span>
  entry<span class="token operator">:</span> <span class="token punctuation">{</span>
    app<span class="token operator">:</span> <span class="token string">'./src/index.js'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  output<span class="token operator">:</span> <span class="token punctuation">{</span>
    path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    filename<span class="token operator">:</span> <span class="token string">'[name].[hash:7].js'</span><span class="token punctuation">,</span> <span class="token comment">// 打包成7位的hash</span>
    publicPath<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token comment">// 项目的跟目录可以配置cdn链接</span>
    chunkFilename<span class="token operator">:</span> <span class="token string">'[name].js'</span><span class="token punctuation">,</span> <span class="token comment">// 单独打包的文件 分包</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> webpackConfig<span class="token punctuation">;</span>
</code></pre></div><p>配置脚本命令</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// package.js 中添加</span>
<span class="token string">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;dev&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><p>执行</p> <blockquote><p>yarn run dev</p></blockquote> <p>控制台会有警告需要设置 mode 打包模式，添加 mode</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// webpack.config.js</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> webpackConfig <span class="token operator">=</span> <span class="token punctuation">{</span>
  mode<span class="token operator">:</span> <span class="token string">'development'</span><span class="token punctuation">,</span> <span class="token comment">// 也可以在脚本命令处配置 mode=development</span>
  entry<span class="token operator">:</span> <span class="token punctuation">{</span>
    app<span class="token operator">:</span> <span class="token string">'./src/index.js'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  output<span class="token operator">:</span> <span class="token punctuation">{</span>
    path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    filename<span class="token operator">:</span> <span class="token string">'[name].[hash:7].js'</span><span class="token punctuation">,</span> <span class="token comment">// 打包成7位的hash</span>
    publicPath<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token comment">// 项目的跟目录可以配置cdn链接</span>
    chunkFilename<span class="token operator">:</span> <span class="token string">'[name].js'</span><span class="token punctuation">,</span> <span class="token comment">// 单独打包的文件 分包</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> webpackConfig<span class="token punctuation">;</span>
</code></pre></div><p>配置入口问价和依赖
安装 vue 和 vue-router</p> <blockquote><p>yarn add vue vue-router -D</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">'vue'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">'./App.vue'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> router <span class="token keyword">from</span> <span class="token string">'./router'</span><span class="token punctuation">;</span>

Vue<span class="token punctuation">.</span>config<span class="token punctuation">.</span>productionTip <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

<span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  router<span class="token punctuation">,</span>
  <span class="token function-variable function">render</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">h</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">h</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">$mount</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>设置模块解析方式 resolve</p> <div class="language-js extra-class"><pre class="language-js"><code>  resolve<span class="token operator">:</span> <span class="token punctuation">{</span>
    extensions<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'.js'</span><span class="token punctuation">,</span> <span class="token string">'.vue'</span><span class="token punctuation">,</span> <span class="token string">'.json'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 解析文件顺序</span>
    alias<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string">'@'</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../src'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// 设置文件别名</span>
   <span class="token comment">// modules: [''], // 设置模块搜索的目录</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><p>配置模块</p> <p>解析 .vue 文件 需要安装 vue-loader vue-template-compiler</p> <blockquote><p>yarn add vue-loader vue-template-compiler -D</p></blockquote> <p>配置 module</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token operator">:</span> <span class="token punctuation">{</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex">/\.vue$/</span><span class="token punctuation">,</span> <span class="token comment">// 匹配.vue结尾的文件</span>
        loader<span class="token operator">:</span> <span class="token string">'vue-loader'</span><span class="token punctuation">,</span>
        options<span class="token operator">:</span> <span class="token punctuation">{</span>
          compilerOptions<span class="token operator">:</span> <span class="token punctuation">{</span>
            preserveWhitespace<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><p>配置 plugins</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> VueLoaderPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'vue-loader/lib/plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 plugins<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">VueLoaderPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
</code></pre></div><p>解析 stylus css 预处理器
安装插件 stylus stylus-loader css-loader vue-style-loader</p> <blockquote><p>yarn add stylus stylus-loader css-loader vue-style-loader -D</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token operator">:</span> <span class="token punctuation">{</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex">/\.vue$/</span><span class="token punctuation">,</span>
        loader<span class="token operator">:</span> <span class="token string">'vue-loader'</span><span class="token punctuation">,</span>
        options<span class="token operator">:</span> <span class="token punctuation">{</span>
          compilerOptions<span class="token operator">:</span> <span class="token punctuation">{</span>
            preserveWhitespace<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex">/\.styl(us)?$/</span><span class="token punctuation">,</span>
        use<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'vue-style-loader'</span><span class="token punctuation">,</span> <span class="token string">'css-loader'</span><span class="token punctuation">,</span> <span class="token string">'stylus-loader'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

</code></pre></div><p>配置 html 主页面</p> <p>安装插件 html-webpack-plugin</p> <blockquote><p>yarn add html-webpack-plugin -D</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> htmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'html-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">VueLoaderPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">htmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      template<span class="token operator">:</span> <span class="token string">'./public/index.html'</span><span class="token punctuation">,</span>
      filename<span class="token operator">:</span> <span class="token string">'./index.html'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
</code></pre></div><p>配置本地服务 webpack-dev-server
安装 webpack-dev-server</p> <blockquote><p>yarn add webpack-dev-server -D</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code>devServer<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 代理服务</span>
    host<span class="token operator">:</span> <span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span>
    port<span class="token operator">:</span> <span class="token number">8085</span><span class="token punctuation">,</span>
    <span class="token comment">// publicPath: '/',</span>
    hot<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 开启热更新</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><p>修改脚本命令</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// package.js 中添加</span>
<span class="token string">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;dev&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack-dev-server&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><p>执行 yarn run dev 在浏览器打开http://127.0.0.1:8085/</p> <p>区分生产和开发 配置环境变量 NODE_ENV
安装 cross-env 它是运行跨平台设置和使用环境变量的脚本
重新配置启动命令</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token string">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;dev&quot;</span><span class="token operator">:</span> <span class="token string">&quot;cross-env NODE_ENV=dev webpack-dev-server&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;cross-env NODE_ENV=prod  webpack&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><p>创建 开发配置文件
mkdir build/webpack.config.dev.js
创建 生产配置文件
mkdir build/webpack.config.prod.js
创建 公用配置文件
mkdir build/webpack.config.common.js</p> <p>修改 webpack.config.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 获取环境命令，并去除首尾空格</span>
<span class="token keyword">const</span> env <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/(\s*$)|(^\s*)/gi</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 根据环境变量引用相关的配置文件</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">./build/webpack.config.</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>env<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.js</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>配置 js babel
安装 babel-loader @babel/core</p> <blockquote><p>yarn add babel-loader @babel/core -D</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code> module<span class="token operator">:</span> <span class="token punctuation">{</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex">/\.(jsx?|babel|es6)$/</span><span class="token punctuation">,</span>
        include<span class="token operator">:</span> process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        exclude<span class="token operator">:</span> <span class="token regex">/node_modules/</span><span class="token punctuation">,</span>
        loader<span class="token operator">:</span> <span class="token string">'babel-loader'</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex">/\.vue$/</span><span class="token punctuation">,</span>
        loader<span class="token operator">:</span> <span class="token string">'vue-loader'</span><span class="token punctuation">,</span>
        options<span class="token operator">:</span> <span class="token punctuation">{</span>
          compilerOptions<span class="token operator">:</span> <span class="token punctuation">{</span>
            preserveWhitespace<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex">/\.styl(us)?$/</span><span class="token punctuation">,</span>
        use<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'vue-style-loader'</span><span class="token punctuation">,</span> <span class="token string">'css-loader'</span><span class="token punctuation">,</span> <span class="token string">'stylus-loader'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><p>配置.babelrc 文件
安装 @babel/preset-env @babel/plugin-proposal-class-properties @babel/plugin-transform-runtime</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
  <span class="token string">&quot;presets&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;@babel/preset-env&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token string">&quot;plugins&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">&quot;@babel/plugin-proposal-class-properties&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;@babel/plugin-transform-runtime&quot;</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>

</code></pre></div><p>设置调试模式 devtool: '#eval-source-map',</p> <p>配置 sass</p> <blockquote><p>yarn add sass-loader node-sass -D</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  module<span class="token operator">:</span> <span class="token punctuation">{</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token comment">// ... 忽略其它规则</span>

      <span class="token comment">// 普通的 `.scss` 文件和 `*.vue` 文件中的</span>
      <span class="token comment">// `&lt;style lang=&quot;scss&quot;&gt;` 块都应用它</span>
      <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex">/\.scss$/</span><span class="token punctuation">,</span>
        use<span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token string">'vue-style-loader'</span><span class="token punctuation">,</span>
          <span class="token string">'css-loader'</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            loader<span class="token operator">:</span> <span class="token string">'sass-loader'</span><span class="token punctuation">,</span>
            options<span class="token operator">:</span> <span class="token punctuation">{</span>
              indentedSyntax<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
              <span class="token comment">// sass-loader version &gt;= 8</span>
              sassOptions<span class="token operator">:</span> <span class="token punctuation">{</span>
                indentedSyntax<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// 插件忽略</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>配置 less</p> <blockquote><p>yarn add less less-loader -D</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
  test<span class="token operator">:</span> <span class="token regex">/\.less$/</span><span class="token punctuation">,</span>
  use<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">'vue-style-loader'</span><span class="token punctuation">,</span>
    <span class="token string">'css-loader'</span><span class="token punctuation">,</span>
    <span class="token string">'less-loader'</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>配置 PostCSS</p> <blockquote><p>yarn add postcss-loader -D</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
  test<span class="token operator">:</span> <span class="token regex">/\.css$/</span><span class="token punctuation">,</span>
  use<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">'vue-style-loader'</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      loader<span class="token operator">:</span> <span class="token string">'css-loader'</span><span class="token punctuation">,</span>
      options<span class="token operator">:</span> <span class="token punctuation">{</span> importLoaders<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">'postcss-loader'</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>配置 TypeScript</p> <blockquote><p>yarn add typescript ts-loader -D</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  resolve<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 将 `.ts` 添加为一个可解析的扩展名。</span>
    extensions<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'.ts'</span><span class="token punctuation">,</span> <span class="token string">'.js'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  module<span class="token operator">:</span> <span class="token punctuation">{</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token comment">// ... 忽略其它规则</span>
      <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex">/\.ts$/</span><span class="token punctuation">,</span>
        loader<span class="token operator">:</span> <span class="token string">'ts-loader'</span><span class="token punctuation">,</span>
        options<span class="token operator">:</span> <span class="token punctuation">{</span> appendTsSuffixTo<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token regex">/\.vue$/</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// ...plugin omitted</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>配置 Pug</p> <blockquote><p>yarn add pug pug-plain-loader -D</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
  test<span class="token operator">:</span> <span class="token regex">/\.pug$/</span><span class="token punctuation">,</span>
  oneOf<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token comment">// 这条规则应用到 Vue 组件内的 `&lt;template lang=&quot;pug&quot;&gt;`</span>
    <span class="token punctuation">{</span>
      resourceQuery<span class="token operator">:</span> <span class="token regex">/^\?vue/</span><span class="token punctuation">,</span>
      use<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'pug-plain-loader'</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// 这条规则应用到 JavaScript 内的 pug 导入</span>
    <span class="token punctuation">{</span>
      use<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'raw-loader'</span><span class="token punctuation">,</span> <span class="token string">'pug-plain-loader'</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>配置插件</p> <p>配置分析插件 SpeedMeasurePlugin</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> SpeedMeasurePlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'speed-measure-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> smp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SpeedMeasurePlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> smp<span class="token punctuation">.</span><span class="token function">wrap</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token operator">...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>优化项配置</p> <p>配置缓存 cache-loader thread-loader</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex">/\.(jsx?|babel|es6)$/</span><span class="token punctuation">,</span>
        include<span class="token operator">:</span> process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 运行的目录</span>
        exclude<span class="token operator">:</span> <span class="token regex">/node_modules/</span><span class="token punctuation">,</span>
        use<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'cache-loader'</span><span class="token punctuation">,</span> <span class="token string">'thread-loader'</span><span class="token punctuation">,</span> <span class="token string">'babel-loader'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><p>配置 optimization</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/**
     * 优化项
     */</span>
    optimization<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token comment">/**
       * 分割代码块，如果只有一个入口，就不需要分割了，只有多页，才需要把公共的抽离出来
       * @param cacheGroups 缓存组
       * @param vendors 第三方库
       * @param common 公共的模块
       * @param priority 添加权重
       * @param minChunks 重复2次使用的时候需要抽离出来
       *
       */</span>
      splitChunks<span class="token operator">:</span> <span class="token punctuation">{</span>
        cacheGroups<span class="token operator">:</span> <span class="token punctuation">{</span>
          vendors<span class="token operator">:</span> <span class="token punctuation">{</span>
            name<span class="token operator">:</span> <span class="token string">'chunk-vendors'</span><span class="token punctuation">,</span>
            test<span class="token operator">:</span> <span class="token regex">/node_modules/</span><span class="token punctuation">,</span>
            priority<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
            chunks<span class="token operator">:</span> <span class="token string">'initial'</span><span class="token punctuation">,</span> <span class="token comment">// 刚开始就要抽离</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          common<span class="token operator">:</span> <span class="token punctuation">{</span>
            name<span class="token operator">:</span> <span class="token string">'chunk-common'</span><span class="token punctuation">,</span>
            minChunks<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
            priority<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">20</span><span class="token punctuation">,</span>
            chunks<span class="token operator">:</span> <span class="token string">'initial'</span><span class="token punctuation">,</span>
            reuseExistingChunk<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      minimizer<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">TerserPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          sourceMap<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
          cache<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
          parallel<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
          extractComments<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token keyword">new</span> <span class="token class-name">OptimizeCssnanoPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>

</code></pre></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">5/11/2020, 10:48:57 PM</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.7c156770.js" defer></script><script src="/assets/js/2.749b24a5.js" defer></script><script src="/assets/js/3.df6a8ba6.js" defer></script><script src="/assets/js/18.b0d81135.js" defer></script>
  </body>
</html>
