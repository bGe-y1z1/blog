<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>持续部署jenkins | B格</title>
    <meta name="generator" content="VuePress 1.4.1">
    
    <meta name="description" content=" 装B的起点">
    <link rel="preload" href="/assets/css/0.styles.c14d9a4b.css" as="style"><link rel="preload" href="/assets/js/app.383fa865.js" as="script"><link rel="preload" href="/assets/js/2.5dc9a9ef.js" as="script"><link rel="preload" href="/assets/js/3.df6a8ba6.js" as="script"><link rel="preload" href="/assets/js/11.77d2cc87.js" as="script"><link rel="prefetch" href="/assets/js/10.5c3fdbf8.js"><link rel="prefetch" href="/assets/js/12.2bf636c6.js"><link rel="prefetch" href="/assets/js/13.2b7be7f9.js"><link rel="prefetch" href="/assets/js/14.574d436d.js"><link rel="prefetch" href="/assets/js/15.8d256e43.js"><link rel="prefetch" href="/assets/js/16.cb77df45.js"><link rel="prefetch" href="/assets/js/17.b2655238.js"><link rel="prefetch" href="/assets/js/18.e258aa43.js"><link rel="prefetch" href="/assets/js/19.b4781292.js"><link rel="prefetch" href="/assets/js/20.07ef5f5a.js"><link rel="prefetch" href="/assets/js/21.6b540238.js"><link rel="prefetch" href="/assets/js/22.52128a8f.js"><link rel="prefetch" href="/assets/js/23.80b7edd6.js"><link rel="prefetch" href="/assets/js/24.d36cc6fe.js"><link rel="prefetch" href="/assets/js/25.28c4b96c.js"><link rel="prefetch" href="/assets/js/26.0219c8aa.js"><link rel="prefetch" href="/assets/js/27.4b66ddd6.js"><link rel="prefetch" href="/assets/js/28.2e7a59d2.js"><link rel="prefetch" href="/assets/js/29.be246490.js"><link rel="prefetch" href="/assets/js/30.848f1381.js"><link rel="prefetch" href="/assets/js/4.fb8bdd37.js"><link rel="prefetch" href="/assets/js/5.a677749f.js"><link rel="prefetch" href="/assets/js/6.a489a3f1.js"><link rel="prefetch" href="/assets/js/7.d7eacd7f.js"><link rel="prefetch" href="/assets/js/8.8c9ac2b3.js"><link rel="prefetch" href="/assets/js/9.40f9bcfe.js">
    <link rel="stylesheet" href="/assets/css/0.styles.c14d9a4b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/hero.png" alt="B格" class="logo"></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">home</a></div><div class="nav-item"><a href="/pages/vue/" class="nav-link">vue</a></div><div class="nav-item"><a href="/pages/react/" class="nav-link">react</a></div><div class="nav-item"><a href="/pages/node/" class="nav-link">node</a></div><div class="nav-item"><a href="/pages/webpack/" class="nav-link">webpack</a></div><div class="nav-item"><a href="/pages/wx/" class="nav-link">wx</a></div><div class="nav-item"><a href="/pages/reactNative/" class="nav-link">RN</a></div><div class="nav-item"><a href="/pages/flutter/" class="nav-link">flutter</a></div><div class="nav-item"><a href="/blog/" class="nav-link router-link-active">blog</a></div><div class="nav-item"><a href="https://github.com/bGe-y1z1/blog" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">home</a></div><div class="nav-item"><a href="/pages/vue/" class="nav-link">vue</a></div><div class="nav-item"><a href="/pages/react/" class="nav-link">react</a></div><div class="nav-item"><a href="/pages/node/" class="nav-link">node</a></div><div class="nav-item"><a href="/pages/webpack/" class="nav-link">webpack</a></div><div class="nav-item"><a href="/pages/wx/" class="nav-link">wx</a></div><div class="nav-item"><a href="/pages/reactNative/" class="nav-link">RN</a></div><div class="nav-item"><a href="/pages/flutter/" class="nav-link">flutter</a></div><div class="nav-item"><a href="/blog/" class="nav-link router-link-active">blog</a></div><div class="nav-item"><a href="https://github.com/bGe-y1z1/blog" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <!----> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="持续部署jenkins"><a href="#持续部署jenkins" class="header-anchor">#</a> 持续部署jenkins</h1> <p><img src="/Jenkins/jenkinsList.png" alt="nodeJS"></p> <h3 id="一、安装jenkins-安装步骤请看jenkens官网"><a href="#一、安装jenkins-安装步骤请看jenkens官网" class="header-anchor">#</a> 一、安装jenkins 安装步骤请看<a href="https://jenkins.io/zh/doc/tutorials/build-a-node-js-and-react-app-with-npm/#fork-sample-repository" target="_blank" rel="noopener noreferrer">jenkens官网<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h3> <p>1、安装JDK</p> <div class="language- extra-class"><pre><code>  yum install -y java
</code></pre></div><p>2、 安装jenkins</p> <div class="language- extra-class"><pre><code>   1 wget -O /etc/yum.repos.d/jenkins.repo http://pkg.jenkins-ci.org/redhat/jenkins.repo
   2 rpm --import https://jenkins-ci.org/redhat/jenkins-ci.org.key
   3 yum install -y jenkins
</code></pre></div><p>如果不能安装就到官网下载jenkis的rmp包，官网地址（http://pkg.jenkins-ci.org/redhat-stable/）</p> <div class="language- extra-class"><pre><code>   1 wget http://pkg.jenkins-ci.org/redhat-stable/jenkins-2.7.3-1.1.noarch.rpm
   2 rpm -ivh jenkins-2.7.3-1.1.noarch.rpm
</code></pre></div><p>配置jenkis的端口</p> <div class="language- extra-class"><pre><code>vi /etc/sysconfig/jenkins
</code></pre></div><p>找到修改端口号：</p> <p>JENKINS_PORT=&quot;8080&quot;  此端口不冲突可以不修改</p> <p>3、启动jenkins</p> <div class="language- extra-class"><pre><code>service jenkins start/stop/restart
</code></pre></div><div class="custom-block tip"><p>安装成功后Jenkins将作为一个守护进程随系统启动</p> <p>系统会创建一个“jenkins”用户来允许这个服务，如果改变服务所有者，同时需要修改/var/log/jenkins, /var/lib/jenkins, 和/var/cache/jenkins的所有者</p> <p>启动的时候将从/etc/sysconfig/jenkins获取配置参数</p> <p>默认情况下，Jenkins运行在8080端口，在浏览器中直接访问该端进行服务配置</p> <p>Jenkins的RPM仓库配置被加到/etc/yum.repos.d/jenkins.repo</p></div> <p>4、打开jenkins</p> <p>在浏览器中访问
首次进入会要求输入初始密码如下图，
初始密码在：/var/lib/jenkins/secrets/initialAdminPassword
66ccf7466b1d4bfdaefbc1113470a4e2</p> <h3 id="二、-jenkins相关插件的安装"><a href="#二、-jenkins相关插件的安装" class="header-anchor">#</a> 二、 jenkins相关插件的安装</h3> <h5 id="_1、安装nodejs插件-用于项目打包"><a href="#_1、安装nodejs插件-用于项目打包" class="header-anchor">#</a> 1、安装nodeJS插件 用于项目打包</h5> <p>打开 <em>系统管理</em> -- <em>插件管理</em> -- 点击 <em>Available</em> -- 搜索 NodeJS Plugin  然后勾选安装</p> <p>打开 <em>系统管理</em> --<em>全局工具配置</em>   拉到底部 配置  node 版本，如图：</p> <p><img src="/Jenkins/nodeJS.jpg" alt="nodeJS"></p> <div class="custom-block warning"><p>node 使用13.1.0 版本 如需其他版本自行安装</p></div> <h5 id="_2、-配置远程链接"><a href="#_2、-配置远程链接" class="header-anchor">#</a> 2、 配置远程链接</h5> <p>打开 <em>系统管理</em> -- <em>系统设置</em>  找到 “Publish over SSH” 项 ，我这里远程服务器用的是ssh登录，通过ppk密钥进行连接，所以我的配置如图，如果是帐号密码登录的Passphrase填写密码Username填写用户名，path to key 为空就可以了。</p> <p><img src="/Jenkins/ssh1.png" alt="nodeJS"></p> <div class="custom-block tip"><p>获取私钥key值 cat XXX.pem</p></div> <p>点击 Test Configuration 按钮测试连接是否成功</p> <p><img src="/public/Jenkins/ssh2.png" alt="nodeJS"></p> <div class="custom-block tip"><p>前端配置项:<br>
开发： web-dev<br>
测试： web-ft<br>
项目根目录： /usr/local/nginx</p></div> <h3 id="三、-配置自动部署任务"><a href="#三、-配置自动部署任务" class="header-anchor">#</a> 三、 配置自动部署任务</h3> <h5 id="_1、新建任务：点击-新建-填写任务名称，选择构建一个自由风格的软件项目然后保存，如图："><a href="#_1、新建任务：点击-新建-填写任务名称，选择构建一个自由风格的软件项目然后保存，如图：" class="header-anchor">#</a> 1、新建任务：点击 <em>新建</em> --填写任务名称，选择<em>构建一个自由风格的软件项目</em>然后保存，如图：</h5> <p><img src="/Jenkins/newJob1.png" alt="nodeJS"></p> <h5 id="_2、配置git，进入任务配置，选择源码管理-，我这里是git下载项目，所以选择-git-，因为是开源的，所以没有填写账号密码，如图"><a href="#_2、配置git，进入任务配置，选择源码管理-，我这里是git下载项目，所以选择-git-，因为是开源的，所以没有填写账号密码，如图" class="header-anchor">#</a> 2、配置git，进入任务配置，选择源码管理 ，我这里是git下载项目，所以选择 git ，因为是开源的，所以没有填写账号密码，如图</h5> <p><img src="/Jenkins/newJob2.png" alt="nodeJS"></p> <h5 id="_3、设置构建环境，选择-provide-node-npm-bin-folder-to-path-然后选择之前安装插件时候配置的node版本，如图"><a href="#_3、设置构建环境，选择-provide-node-npm-bin-folder-to-path-然后选择之前安装插件时候配置的node版本，如图" class="header-anchor">#</a> 3、设置构建环境，选择 Provide Node &amp; npm bin/ folder to PATH  然后选择之前安装插件时候配置的node版本，如图</h5> <p><img src="/Jenkins/newJob3.png" alt="nodeJS"></p> <h5 id="_4、配置项目自动化打包，选择-增加构建步骤-excute-shell-这个是运行相关的sh命令"><a href="#_4、配置项目自动化打包，选择-增加构建步骤-excute-shell-这个是运行相关的sh命令" class="header-anchor">#</a> 4、配置项目自动化打包，选择 增加构建步骤 ---Excute shell  这个是运行相关的sh命令</h5> <div class="language-js extra-class"><div class="highlight-lines"><br><br><br><div class="highlighted"> </div><br><br><br><br><br></div><pre class="language-js"><code>   echo $<span class="token constant">PATH</span> <span class="token comment">// 进入项目目录</span>
   npm install chromedriver <span class="token operator">--</span>chromedriver_cdnurl<span class="token operator">=</span>http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>cdn<span class="token punctuation">.</span>npm<span class="token punctuation">.</span>taobao<span class="token punctuation">.</span>org<span class="token operator">/</span>dist<span class="token operator">/</span>chromedriver 
   npm install 
   npm run build 
   cd dist 
   rm <span class="token operator">-</span>rf build<span class="token punctuation">.</span>tar<span class="token punctuation">.</span>gz  <span class="token comment">// 删除上次打包的压缩文件</span>
   tar <span class="token operator">-</span>zcvf build<span class="token punctuation">.</span>tar<span class="token punctuation">.</span>gz <span class="token operator">*</span>  <span class="token comment">// 把生成的项目打包成build 方便传输到远程服务器</span>
   cd <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span> 
</code></pre></div><p><img src="/Jenkins/newJob4.png" alt="nodeJS"></p> <h5 id="_5、把打包好的项目文件发布到远程服务器"><a href="#_5、把打包好的项目文件发布到远程服务器" class="header-anchor">#</a> 5、把打包好的项目文件发布到远程服务器</h5> <p>选择 <em>Add build step</em>  --- <em>Send build artifacts over SSH</em></p> <p><img src="/Jenkins/newJob5.png" alt="nodeJS"></p> <div class="custom-block tip"><p>Name：第三步创建的远程服务器名称<br>
 Source files：本地需要传输过去的文件路径<br>
Remove prefix：过滤掉的目录名<br>
Remote directory：远程服务器的保存路径<br>
Exec command：传输完成后在远程服务器执行的sh命令</p></div> <p><img src="/Jenkins/newJob6.png" alt="nodeJS"></p> <div class="language-js extra-class"><div class="highlight-lines"><br><br><br><div class="highlighted"> </div></div><pre class="language-js"><code>    cd <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>nginx<span class="token operator">/</span>cms <span class="token comment">// 进入前端项目目录</span>
    tar <span class="token operator">-</span>zxvf build<span class="token punctuation">.</span>tar<span class="token punctuation">.</span>gz <span class="token operator">-</span><span class="token constant">C</span> dms <span class="token comment">// 将build压缩包文件解压到dms目录</span>
    rm <span class="token operator">-</span>rf build<span class="token punctuation">.</span>tar<span class="token punctuation">.</span>gz <span class="token comment">// 删除压缩包</span>
</code></pre></div><h5 id="_6、保存并构建-持续部署"><a href="#_6、保存并构建-持续部署" class="header-anchor">#</a> 6、保存并构建&amp;持续部署</h5> <p><img src="/public/Jenkins/newJob7.png" alt="nodeJS"></p> <h5 id="_7、-注意是事项"><a href="#_7、-注意是事项" class="header-anchor">#</a> 7、 注意是事项</h5> <div class="custom-block danger"><p>1、访问403 目录权限不够 在服务器上执行 chmod -R 755 /usr/local/nginx/cms</p> <p>2、 nodeJS插件安装不上可以下载node的.hpi文件 之后安装或重启</p></div> <p><img src="/Jenkins/newJob8.png" alt="nodeJS"></p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.383fa865.js" defer></script><script src="/assets/js/2.5dc9a9ef.js" defer></script><script src="/assets/js/3.df6a8ba6.js" defer></script><script src="/assets/js/11.77d2cc87.js" defer></script>
  </body>
</html>
